/*!CK:279109865!*//*1420467631,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["SUEuy"]); }

__d("SortableGroup",["CSS","DOM","Draggable","Droppable","Style","Vector","copyProperties","emptyFunction","removeFromArray"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(){"use strict";this.namespace='sortable'+(++p.instanceCount);this.draggables={};this.droppables={};this.sortables={};this.linkedGroups=[];this.linkedGroups.onbeforelinkjump=n;this.linkedGroups.onlinkjump=n;this.rootNode=null;this.boundingBox=null;this.neverEmpty=false;this.hasEmptyMessage=false;this.isDroppable=true;this.isDraggable=true;this.useScroller=true;this.dragOverCriteria='inside';this.requireSameParent=true;this.anchor=null;this.disabled=false;this.autoWidth=false;}p.prototype.addEmptyMessage=function(q,r){"use strict";var s='placeholder';if(q.parentNode!=r)h.appendContent(r,q);this.emptyMessage=q;this._initializeAdded(s,q);this.hasEmptyMessage=true;this.sortables[s]=q;this.droppables[s]=(new j(q)).setNamespace(this.namespace).setDragOverHandler(this._dragOverHandlerShim.bind(this,s));return this;};p.prototype.setAutoWidth=function(q){"use strict";this.autoWidth=q;return this;};p.prototype.setUseScroller=function(q){"use strict";this.useScroller=q;return this;};p.prototype.setDragOverHorizontally=function(){"use strict";this.dragOverCriteria='horizontal';return this;};p.prototype.setDragOverVertically=function(){"use strict";this.dragOverCriteria='vertical';return this;};p.prototype.removeEmptyMessage=function(){"use strict";if(this.emptyMessage)h.remove(this.emptyMessage);this.hasEmptyMessage=false;this.removeSortable('placeholder');return this;};p.prototype.addSortable=function(q,r,s){"use strict";this._initializeAdded(q,r);this.sortables[q]=r;this.draggables[q]=(new i(r)).setNamespace(this.namespace).setGutter(this.gutter).setUseAbsolute(true).setUseScroller(this.useScroller).setGrabHandler(this.grabHandler.bind(this,q)).setDropHandler(this.dropHandler.bind(this,q)).setKey('key',q).setBoundingBox(this.boundingBox);if(s)this.draggables[q].addHandle(s);this.droppables[q]=(new j(r)).setNamespace(this.namespace).setDragOverHandler(this._dragOverHandlerShim.bind(this,q));if(this.dragOverCriteria==='horizontal'){this.droppables[q].setDragOverHorizontally();}else if(this.dragOverCriteria==='vertical')this.droppables[q].setDragOverVectically();return this;};p.prototype.destroy=function(){"use strict";for(var q in this.droppables)this.droppables[q].destroy();for(var r in this.draggables)this.draggables[r].destroy();this.droppables=this.draggables=this.rootNode=null;o(this.linkedGroups,this);for(var s=0;s<this.linkedGroups.length;s++)this.linkedGroups[s].linkedGroups=this.linkedGroups;};p.prototype.dragOverHandler=function(q,r){"use strict";if(!this.isDroppable&&!this.anchor)return;var s=false;if(!(r in this.draggables)){this.linkedGroups.onbeforelinkjump.call(this,r);if(!this.migrateLinkedSortable(r))throw new Error('Draggable dropped onto a foreign droppable!');s=true;}var t=true,u=this.getSortables(),v=this.sortables[r],w=this.sortables[q];if(!this.anchor){var x=u.length;for(var y=0;y<x;y++)if(u[y]==w){break;}else if(u[y]==v){t=false;break;}}else w=this.anchor;this.onbeforedragover(v,w);var z=this.linkedGroups.placeholder;this.insertPlaceholder(z,w,t||this.anchor);z.parentNode.insertBefore(v,z);this.ondragover(v,w,r,q);if(s)this.linkedGroups.onlinkjump.call(this,r);};p.prototype.dropHandler=function(q){"use strict";if(this._checkLastRemaining()){this.draggables[q].resetPosition();return;}var r=this.linkedGroups.placeholder;g.removeClass(this.sortables[q],'drag');this.draggables[q].resetPosition();r.parentNode.insertBefore(this.sortables[q],r);r.parentNode.removeChild(r);for(var s=0;s<this.linkedGroups.length;s++)if(this.linkedGroups[s].anchor)delete this.linkedGroups[s].anchor;this.ondropcallback(q,this.sortables[q]);this.onorderchange();};p.prototype.getOrder=function(){"use strict";var q=[],r=this.getSortables();for(var s=0;s<r.length;s++)for(var t in this.sortables)if(this.sortables[t]==r[s]){q.push(t);break;}return q;};p.prototype.getSortables=function(){"use strict";return this.rootNode?this.rootNode.childNodes:[];};p.prototype.grabHandler=function(q){"use strict";if(this.disabled||this._checkLastRemaining()||!this.isDraggable){this.draggables[q].killDrag();return;}this.onbeforegrabcallback(this.sortables[q],q);var r=this.linkedGroups.placeholder,s=this.sortables[q];g.setClass(r,s.className);g.addClass(r,'droppable_placeholder');g.addClass(s,'drag');l.getElementDimensions(s).setElementDimensions(r);if(this.autoWidth)k.set(r,'width','auto');s.parentNode.insertBefore(r,s);this.ongrabcallback(this.sortables[q],q);if(!this.isDroppable){this.anchor=s.nextSibling;if(!this.anchor){this.anchor=h.create('div');s.parentNode.appendChild(this.anchor);}}};p.prototype.insertPlaceholder=function(q,r,s){"use strict";if(s){h.insertBefore(r,q);}else h.insertAfter(r,q);};p.prototype.keyExists=function(q){"use strict";return this.sortables[q];};p.prototype.link=function(q){"use strict";q.linkedGroups=this.linkedGroups;if(!this.linkedGroups.length)this.linkedGroups.push(this);this.linkedGroups.push(q);for(var r=0;r<this.linkedGroups.length;r++)if(this.linkedGroups[r].namespace!=this.namespace){this.linkedGroups[r].namespace=this.namespace;for(var s in this.linkedGroups[r].droppables){this.linkedGroups[r].droppables[s].setNamespace(this.namespace);var t=this.linkedGroups[r].draggables[s];t&&t.setNamespace(this.namespace);}}return this;};p.prototype.migrateLinkedSortable=function(q){"use strict";for(var r=0;r<this.linkedGroups.length;r++)if(q in this.linkedGroups[r].draggables){this.sortables[q]=this.linkedGroups[r].sortables[q];this.draggables[q]=this.linkedGroups[r].draggables[q];this.draggables[q].setGrabHandler(this.grabHandler.bind(this,q)).setDropHandler(this.dropHandler.bind(this,q));this.droppables[q]=this.linkedGroups[r].droppables[q];this.droppables[q].setDragOverHandler(this._dragOverHandlerShim.bind(this,q));delete this.linkedGroups[r].sortables[q];delete this.linkedGroups[r].draggables[q];delete this.linkedGroups[r].droppables[q];return true;}return false;};p.prototype.removeSortable=function(q){"use strict";if(q in this.sortables){if(q in this.draggables)this.draggables[q].destroy();if(q in this.droppables)this.droppables[q].destroy();delete this.draggables[q];delete this.droppables[q];delete this.sortables[q];}};p.prototype.removeAllSortables=function(){"use strict";for(var q in this.sortables)this.removeSortable(q);};p.prototype.setDisabled=function(q){"use strict";this.disabled=q;return this;};p.prototype.forceDrop=function(q){"use strict";if(q in this.sortables)this.draggables[q].forceDrop();};p.prototype.killDrag=function(q){"use strict";if(q in this.sortables)this.draggables[q].killDrag();};p.prototype.setBeforeGrabCallback=function(q){"use strict";this.onbeforegrabcallback=q;return this;};p.prototype.setBoundingBox=function(q){"use strict";this.boundingBox=q;for(var r in this.draggables)this.draggables[r].setBoundingBox(this.boundingBox);return this;};p.prototype.setBeforeDragOverCallback=function(q){"use strict";this.onbeforedragover=q;return this;};p.prototype.setDragOverCallback=function(q){"use strict";this.ondragover=q;return this;};p.prototype.setDropCallback=function(q){"use strict";this.ondropcallback=q;return this;};p.prototype.setDroppable=function(q){"use strict";this.isDroppable=q;return this;};p.prototype.setDraggable=function(q){"use strict";this.isDraggable=q;return this;};p.prototype.setGrabCallback=function(q){"use strict";this.ongrabcallback=q;return this;};p.prototype.setBeforeLinkJumpHandler=function(q){"use strict";this.linkedGroups.onbeforelinkjump=q;return this;};p.prototype.setInsertPlaceholderHandler=function(q){"use strict";this.insertPlaceholder=q;};p.prototype.setLinkJumpHandler=function(q){"use strict";this.linkedGroups.onlinkjump=q;return this;};p.prototype.setNeverEmpty=function(q){"use strict";this.neverEmpty=q;};p.prototype.setOrderChangeHandler=function(q){"use strict";this.onorderchange=q;return this;};p.prototype.setRequireSameParent=function(q,r){"use strict";this.requireSameParent=r;};p.prototype.setSortablesGetter=function(q){"use strict";this.getSortables=q;};p.prototype._checkLastRemaining=function(q){"use strict";var r=this.hasEmptyMessage?2:1;return this.neverEmpty&&this.getSortables().length==r;};p.prototype._dragOverHandlerShim=function(q,r){"use strict";this.dragOverHandler(q,r.getKey('key'));};p.prototype._initializeAdded=function(q,r){"use strict";if(this.rootNode===null){this.rootNode=r.parentNode;if(!this.linkedGroups.placeholder)this.linkedGroups.placeholder=h.create(r.tagName,{className:'dragPlaceholder',style:{padding:'0'}});}else if(this.requireSameParent&&this.rootNode!=r.parentNode)throw new Error('All sortables of a collection must share the same parentNode');if(q in this.draggables)throw new Error('All sortables must have a unique key');};p.instanceCount=0;m(p.prototype,{gutter:15,onbeforegrabcallback:n,onbeforedragover:n,ondragover:n,ondropcallback:n,ongrabcallback:n,onorderchange:n});e.exports=a.SortableGroup||p;},null);
__d("PhotoInlineOrganizer",["AsyncRequest","AsyncResponse","CSS","DOM","Event","Parent","SortableGroup","$"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(p,q){"use strict";this.root=n(p);this.url=q;this.IDLE='idle';this.PENDING='pending';this.SAVING='saving';this.UP='up';this.DOWN='down';this.state=this.IDLE;this.sortable=new m();this.sortable.setAutoWidth(o.autoWidth);this.sortable.setRequireSameParent(false);this.sortable.setSortablesGetter(function(){return j.scry(this.root,'div.dragWrapper');}.bind(this));this.sortable.setInsertPlaceholderHandler(this.insertPlaceholder.bind(this));this.sortable.setOrderChangeHandler(this.onSave.bind(this));o.cache[p]=this;o.refresh(p);this.order=this.sortable.getOrder();this.offsetDelta=0;k.listen(this.root,'click',this.moveListener.bind(this));}o.prototype.getItems=function(){"use strict";return j.scry(this.root,'div.dragWrapper').filter(function(p){return !i.hasClass(p,'drag');});};o.prototype.moveListener=function(event){"use strict";var p=event.getTarget();if(i.hasClass(p,'arrow')){this.movePhoto(l.byClass(p,'dragWrapper'),i.hasClass(p,this.DOWN)?this.DOWN:this.UP);p.focus();return false;}};o.prototype.movePhoto=function(p,q){"use strict";var r=j.scry(this.root,'td'),s=this.getItems(),t=s.indexOf(p),u=0;if(q==this.UP&&t>0){u=-1;}else if(q==this.DOWN&&t<s.length-1)u=1;if(u!==0){j.appendContent(r[t+this.offsetDelta],s[t+u]);j.appendContent(r[t+u+this.offsetDelta],s[t]);}this.onSave();};o.prototype.save=function(){"use strict";if(this.state!=this.IDLE){this.state=this.PENDING;}else{this.state=this.SAVING;new g().setURI(this.url).setMethod('POST').setData({order:this.order}).setHandler(this.saveResponse.bind(this)).setErrorHandler(this.saveResponse.bind(this)).send();}};o.prototype.saveResponse=function(p){"use strict";var q=this.state;this.state=this.IDLE;if(q==this.PENDING)this.save();if(p.getError())h.verboseErrorHandler(p);};o.prototype.onSave=function(){"use strict";var p=this.sortable.getOrder();if(p.join('|')!=this.order.join('|')){this.order=p;this.save();}};o.prototype.insertPlaceholder=function(p,q,r){"use strict";var s=j.scry(this.root,'td'),t=this.getItems(),u=t.indexOf(q),v=t.indexOf(p),w;if(u>v){for(w=v;w<u;w++)j.appendContent(s[w+this.offsetDelta],t[w+1]);}else for(w=v-1;w>=u;w--)j.appendContent(s[w+1+this.offsetDelta],t[w]);j.appendContent(s[u+this.offsetDelta],p);};o.refresh=function(p){"use strict";var q=o.cache[p];j.scry(q.root,'td').forEach(function(r){if(r.getAttribute('data-id')){var s=j.find(r,'div.dragWrapper'),t=j.find(s,'a.uiMediaThumb');q.sortable.addSortable(r.getAttribute('data-id'),s,t);r.removeAttribute('data-id');}});};o.getInlineOrganizer=function(p){"use strict";var q=n(p),r=j.scry(q,'table')[0];return o.cache[r.id];};o.setOffsetDelta=function(p,q){"use strict";var r=o.getInlineOrganizer(p);r.offsetDelta=Math.max(r.offsetDelta,q);};o.setAutoWidth=function(p,q){"use strict";var r=o.getInlineOrganizer(p);r.sortable.setAutoWidth(q);};o.appendToExisting=function(p,q){"use strict";var r=o.getInlineOrganizer(p),s=j.find(r.root,'tbody'),t=n(q),u=j.find(t,'table');j.scry(u,'tr').forEach(function(w){s.appendChild(w);});var v=j.scry(t,'.uiMorePager');if(v.length>0)t.appendChild(v[0].parentNode);o.refresh(r.root.id);};o.cache={};e.exports=o;},null);
__d("legacy:photo-inline-organizer-js",["PhotoInlineOrganizer"],function(a,b,c,d){a.PhotoInlineOrganizer=b('PhotoInlineOrganizer');},3);
__d("XPhotoBatchEditLocationControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b("XControllerURIBuilder").create("\/photos\/edit\/batch\/location\/",{});},null);