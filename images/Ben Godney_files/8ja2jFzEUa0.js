/*!CK:3685744021!*//*1420577948,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["IgSzm"]); }

__d("MessagingForwardAttachmentDialog.react",["AsyncRequest","ChatMiniSidebarSearchSource","Image.react","LayerFadeOnHide","Layout.react","Map","MessagingRecipientSelectedList.react","MessagingRecipientTypeaheadView.react","OrderedFriendsList","React","SearchableTextInput.react","ScrollableArea.react","XMessagingForwardAttachmentControllerURIBuilder","XUIDialog.react","XUIDialogBody.react","XUIDialogButton.react","XUIDialogCancelButton.react","XUIDialogFooter.react","XUIDialogTitle.react","XUISpinner.react","cx","fbt","xuiglyph"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca){var da=k.Column,ea=k.FillColumn,fa=p.createClass({displayName:"MessagingForwardAttachmentDialog",propTypes:{attachmentID:p.PropTypes.string.isRequired,onClose:p.PropTypes.func,shown:p.PropTypes.bool.isRequired,title:p.PropTypes.string.isRequired},getInitialState:function(){return {bootstrappedEntries:[],entries:[],loading:true,selectedEntries:new l(),sendError:null,sending:false,startingThreadingID:Date.now(),query:''};},componentDidMount:function(){this._dataSource=new h({queryRequests:[{uri:'/ajax/mercury/composer_query.php'}]});o.getSearchableEntries(20,function(ga){this.setState({bootstrappedEntries:ga,loading:false});}.bind(this));},_onSelectEntry:function(ga){var ha=ga.getUniqueID(),ia=new l(this.state.selectedEntries);if(ia.has(ha)){ia["delete"](ha);}else ia.set(ha,ga);this.setState({selectedEntries:ia});},_onSearchChange:function(ga){var ha=ga.target.value;this.setState({loading:true,query:ha});},_onSearchEntriesFound:function(ga){this.setState({entries:ga});},_onSearchFinished:function(ga){ga===this.state.query&&this.setState({loading:false});},_onSubmit:function(){var ga={},ha=this.state.startingThreadingID;this.state.selectedEntries.forEach(function(ja){ga[ha++]=ja.getUniqueID();});var ia=new s().getURI();new g(ia).setMethod('POST').setHandler(this._onSubmitResponse).setData({attachment_id:this.props.attachmentID,recipient_map:ga}).send();this.setState({sending:true,sendError:null});},_onSubmitResponse:function(ga){if(ga.payload.success){this.props.onClose&&this.props.onClose();this.setState({bootstrappedEntries:[],selectedEntries:new l(),sending:false,startingThreadID:Date.now(),query:''});return;}this.setState({sending:false,sendError:ga.payload.error});},render:function(){var ga=("Send Message");if(this.state.selectedEntries.size>1)ga=("Send Messages");var ha=null;if(this.state.sending){ha=(p.createElement("div",null,p.createElement(z,null),p.createElement("span",{className:"_5s0d _3-99"},"Sending")));}else if(this.state.sendError){var ia=ca({name:'error-solid',shade:'dark',size:'medium'});ha=(p.createElement("div",{className:"_5s0d"},p.createElement(i,{src:ia}),p.createElement("span",{className:"_3-99"},this.state.sendError)));}return (p.createElement(t,{shown:this.props.shown,behaviors:{LayerFadeOnHide:j},width:560},p.createElement(y,null,this.props.title),p.createElement(u,{useCustomPadding:true},p.createElement(k,null,p.createElement(da,{className:"_5s0e"},p.createElement("div",{className:"_2ph_"},p.createElement(q,{className:"_5s0f",onChange:this._onSearchChange,onEntriesFound:this._onSearchEntriesFound,placeholder:"Search",queryString:this.state.query,searchSource:this._dataSource,searchSourceOptions:{onQueryFinished:this._onSearchFinished}})),p.createElement(r,{className:"_5s0g",fade:true,height:400,width:360},p.createElement(n,{entries:this.state.query?this.state.entries:this.state.bootstrappedEntries,loading:this.state.loading,selectedEntries:this.state.selectedEntries,onSelect:this._onSelectEntry}))),p.createElement(ea,{className:"_5s0h"},p.createElement(r,{fade:true,height:457,shadow:false},p.createElement(m,{entries:this.state.selectedEntries,onSelect:this._onSelectEntry}))))),p.createElement(x,{leftContent:ha},p.createElement(w,null),p.createElement(v,{use:"confirm",disabled:!this.state.selectedEntries.size||this.state.sending,label:ga,onClick:this._onSubmit}))));}});e.exports=fa;},null);