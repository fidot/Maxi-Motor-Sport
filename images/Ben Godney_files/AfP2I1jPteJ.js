/*!CK:1959860448!*//*1420450796,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["7IWZx"]); }

__d("ChatMiniSidebarSearchSource",["AbstractSearchSource","AsyncRequest","ChatSortUsers","CurrentUser","MercuryParticipantTypes","OrderedFriendsList","SearchableEntry","SearchSourceCallbackManager","ShortProfiles","TokenizeUtil","copyProperties","emptyFunction","isValidUniqueID"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){'use strict';for(var t in g)if(g.hasOwnProperty(t))v[t]=g[t];var u=g===null?null:g.prototype;v.prototype=Object.create(u);v.prototype.constructor=v;v.__superConstructor__=g;function v(w){this.$ChatMiniSidebarSearchSource0=new n({parseFn:p.parse,matchFn:p.isQueryMatch,indexFn:w.indexFn});this.$ChatMiniSidebarSearchSource1=[];this.$ChatMiniSidebarSearchSource2=w.queryRequests||[];}v.prototype.bootstrapImpl=function(w){o.fetchAll().then(function(){this.$ChatMiniSidebarSearchSource3();w();}.bind(this));};v.prototype.searchImpl=function(w,x,y){var z=null,aa={},ba=y&&y.onQueryFinished,ca=this.$ChatMiniSidebarSearchSource0.search(w,function(fa){if(!z){z=fa;z.forEach(function(ga){return aa[ga.getUniqueID()]=true;});}else fa.forEach(function(ga){var ha=ga.getUniqueID();if(!aa[ha]){z.push(ga);aa[ha]=true;}});x(z,w);},y);if(!ca||!this.$ChatMiniSidebarSearchSource2||!this.$ChatMiniSidebarSearchSource2.length){ba&&ba(w);return;}var da={value:w,existing_ids:z&&z.map(function(fa){return fa.getUniqueID();}).join(',')},ea=this.$ChatMiniSidebarSearchSource2.length;this.$ChatMiniSidebarSearchSource2.forEach(function(fa){this.$ChatMiniSidebarSearchSource4(da,fa,function(ga){this.$ChatMiniSidebarSearchSource5(this.$ChatMiniSidebarSearchSource6(this.$ChatMiniSidebarSearchSource7(ga)),w);ea--;if(ea===0){this.$ChatMiniSidebarSearchSource0.setQueryStringAsExhausted(w);ba&&ba(w);}}.bind(this));}.bind(this),this);};v.prototype.getBootstrappedEntries=function(w){return this.bootstrap(function(){return w(this.$ChatMiniSidebarSearchSource1||[]);}.bind(this));};v.prototype.getAllEntriesMap=function(){return this.$ChatMiniSidebarSearchSource0.getAllEntries();};v.prototype.$ChatMiniSidebarSearchSource3=function(){var w=o.getCachedProfileIDs(),x=w.filter(function(z){var aa=o.getNow(z);return (z==j.getID()||aa.type===k.FRIEND);});x.sort(i.sort);var y=x.map(this.$ChatMiniSidebarSearchSource8);if(y.length){this.$ChatMiniSidebarSearchSource0.addLocalEntries(y);this.$ChatMiniSidebarSearchSource1=this.$ChatMiniSidebarSearchSource1.concat(y);}};v.prototype.$ChatMiniSidebarSearchSource6=function(w){return w.map(this.$ChatMiniSidebarSearchSource9,this);};v.prototype.$ChatMiniSidebarSearchSource9=function(w,x){if(w.mercury_thread)return l.normalizeThreadEntry(w,x);var y=w.text,z=w.uid;if(!y||!s(z))return null;return new m({uniqueID:z,title:y,order:l.getActiveRank(z),subtitle:w.subtext,type:w.render_type||w.type,photo:w.photo,uri:w.path});};v.prototype.$ChatMiniSidebarSearchSource7=function(w){var x=w.getPayload();if(Array.isArray(x)){return x;}else if(x&&x.entries){return x.entries;}else return [];};v.prototype.$ChatMiniSidebarSearchSource8=function(w,x){var y=o.getNow(w),z=w==j.getID()?k.FRIEND:y.type,aa=[y.additionalName,y.alternateName].concat(y.searchTokens||[]).join(' ');return new m({uniqueID:w,title:y.name,order:x,subtitle:y.additionalName,keywordString:aa,type:z,photo:y.thumbSrc,uri:y.uri});};v.prototype.$ChatMiniSidebarSearchSource4=function(w,x,y,z){new h(x.uri).setData(q({},w,x.data)).setMethod('GET').setReadOnly(true).setHandler(y).setErrorHandler(z||r).send();};v.prototype.$ChatMiniSidebarSearchSource5=function(w,x){if(w.length)this.$ChatMiniSidebarSearchSource0.addQueryEntries(w.filter(function(y){return !!y;}),x);};v.prototype.refreshData=function(){o.fetchAll();d(['AvailableList'],function(w){return w.update();});};e.exports=v;},null);